<div ng-keydown="onKeyDown($event)"
     ng-keypress="onKeyPress($event)"
     tabindex="0"
     style="vertical-align:top">
  <strong>Game Id : {{game.id}}</strong><br />
  <svg id="canvas"
       style="border:1px solid black;display: inline-block;margin:0;padding:0;"
       width="800px" height="800px"
       viewBox="
       {{game.board.view.x}} {{game.board.view.y}}
       {{game.board.view.width}} {{game.board.view.height}}"
       preserveAspectRatio="xMinYMin meet"
       ng-mousedown="doSelectStart($event)"
       ng-mousemove="doSelectMove($event)"
       ng-mouseup="doSelectStop($event)">
    <defs>
      <marker id="ruler-start"
              markerWidth="6" markerHeight="8"
              refx="0" refy="4"
              orient="auto">
        <polygon points="6,8 0,4 6,0"
                 style="
                 fill:#0CC;
                 "
                 />
        <line x1="0" y1="1" x2="0" y2="7"
                 style="
                 stroke:#0CC;
                 stroke-width:2px;
                 "
                 />
      </marker>
      <marker id="ruler-end"
              markerWidth="6" markerHeight="8"
              refx="6" refy="4"
              orient="auto">
        <polygon points="0,8 6,4 0,0"
                 style="
                 fill:#0CC;
                 "
                 />
        <line x1="6" y1="1" x2="6" y2="7"
                 style="
                 stroke:#0CC;
                 stroke-width:2px;
                 "
                 />
      </marker>
    </defs>
    <image x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           xlink:href="data/Board.png"
           style="display: {{game.board.layers.board ? 'inline' : 'none'}}"
           />
    <svg x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
         style="display: {{game.board.layers.terrain ? 'inline' : 'none'}}"
         >
      <rect x="120" y="136" width="60" height="43"
            style="
            fill:#00F;
            fill-opacity:0.2;
            "
            transform="rotate(40, 150, 155)"
            />
      <rect x="295" y="308" width="85" height="64"
            style="
            fill:#00F;
            fill-opacity:0.2;
            "
            transform="rotate(40, 338, 340)"
            />
      <rect x="205" y="242" width="70" height="7"
            style="
            fill:#F00;
            fill-opacity:0.2;
            "
            transform="rotate(84, 240, 245)"
            />
      <circle cx="90" cy="242" r="29"
              style="
              fill:#0F0;
              fill-opacity:0.2;
              "
              />
      <circle cx="390" cy="242" r="29"
              style="
              fill:#0F0;
              fill-opacity:0.2;
              "
              />
    </svg>
    <svg x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
         style="display: {{game.board.layers.scenario ? 'inline' : 'none'}}"
         >
      <rect x="140" y="140" width="200" height="200"
            style="
            fill:none;
            stroke:#990;
            stroke-width:0.5px;
            "
            />
      <rect x="180" y="210" width="120" height="60"
            style="
            fill:#CC0;
            fill-opacity:0.3;
            stroke:#990;
            stroke-width:0.5px;
            "
            />
      <circle cx="180" cy="270" r="9.842"
            style="
            fill:#CC0;
            fill-opacity:0.8;
            stroke:#C90;
            stroke-width:0.5px;
            "
            />
      <!-- <circle cx="180" cy="270" r="49.842"
      style="
      fill:#C60;
      fill-opacity:0.1;
      stroke:#C90;
      stroke-width:0.5px;
      "
      /> -->
      <circle cx="300" cy="210" r="9.842"
            style="
            fill:#CC0;
            fill-opacity:0.8;
            stroke:#C90;
            stroke-width:0.5px;
            "
            />
      <!-- <circle cx="300" cy="210" r="49.842"
      style="
      fill:#C60;
      fill-opacity:0.1;
      stroke:#C90;
      stroke-width:0.5px;
      "
      /> -->
    </svg>
    <svg id="model-canvas"
         x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
         style="display: {{game.board.layers.models ? 'inline' : 'none'}}"
         >
      <svg ng-repeat="model in game.models"
           x="{{model.state.x}}" y="{{model.state.y}}">
        <g transform="rotate({{model.state.rot}}, 30, 30)">
          <path d="
                M{{10-model.img.r}},30
                L{{50+model.img.r}},30
                A{{20+model.img.r}},{{20+model.img.r}} 0 0,0 {{10-model.img.r}},30
                "
                style="
                stroke:#000;
                stroke-width:0.5px;
                pointer-events: none;
                fill: #000;
                fill-opacity: 0.5;
                "
                ng-show="model.state.show.reach"
                />
          <path d="
                M{{25-model.img.r}},30
                L{{35+model.img.r}},30
                A{{5+model.img.r}},{{5+model.img.r}} 0 0,0 {{25-model.img.r}},30
                "
                style="
                stroke:#000;
                stroke-width:0.5px;
                pointer-events: none;
                fill: #000;
                fill-opacity: 0.5;
                "
                ng-show="model.state.show.melee"
                />
          <image x="{{model.img.x}}" y="{{model.img.y}}"
                 width="{{model.img.width}}" height="{{model.img.height}}"
                 xlink:href="{{model.img.link}}"
                 style="pointer-events: none"
                 />
          <circle ng-mousedown="onModelMouseDown($event, model)"
                  ng-click="onModelClick($event, model)"
                  cx="{{model.img.width/2}}" cy="{{model.img.height/2}}" r="{{model.img.r}}"
                  style="
                  fill:#F00;
                  fill-opacity:0.5;
                  stroke-width:1px;
                  "
                  ng-style="{
                  'stroke': model.state.active ? '#0F0' : none
                  }"
                  
                  /> 
        </g>
      </svg>
    </svg>
    <rect x="{{selection.x}}" y="{{selection.y}}"
          width="{{selection.width}}" height="{{selection.height}}"
          style="
          fill: none;
          stroke:#00F;
          stroke-width:0.5px;
          " />
    <g ng-show="game.ruler.state.active"
       style="pointer-events: none"
       >
      <line x1="{{game.ruler.state.x1}}" y1="{{game.ruler.state.y1}}"
            x2="{{game.ruler.state.x2}}" y2="{{game.ruler.state.y2}}"
            style="
            stroke:#0FF;
            stroke-width:1px;
            marker-start:url(#ruler-start);
            marker-end:url(#ruler-end);
            "
            />
      <rect x="{{(game.ruler.state.x2-game.ruler.state.x1)/2+game.ruler.state.x1-2.5}}"
            y="{{(game.ruler.state.y2-game.ruler.state.y1)/2+game.ruler.state.y1-4}}"
            width="30" height="10"
            style="
            fill:#FFC;
            stroke:#000;
            stroke-width:0.5px;
            "
            />
      <text x="{{(game.ruler.state.x2-game.ruler.state.x1)/2+game.ruler.state.x1}}"
            y="{{(game.ruler.state.y2-game.ruler.state.y1)/2+game.ruler.state.y1+4}}"
            style="
            font-size:8px;
            ">
        {{game.ruler.state.length}}"
      </text>
    </g>
  </svg>
  <div style="display:inline-block;vertical-align:top;">
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;">
      <div><strong>Tools :</strong></div>
      <input id="tools-ruler-check"
             type="checkbox"
             ng-model="drag_mode"
             ng-true-value="'ruler'"
             ng-false-value="'selection'"
             ng-change="onDragModeChange()"
             />
      <label for="tools-ruler-check">Ruler</label>
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;">
      <div><strong>Layers :</strong></div>
      <input id="layer-board-check"
             type="checkbox"
             ng-model="game.board.layers.board" />
      <label for="layer-board-check">Board</label>
      <input id="layer-terrain-check"
             type="checkbox"
             ng-model="game.board.layers.terrain" />
      <label for="layer-terrain-check">Terrain</label>
      <input id="layer-scenario-check"
             type="checkbox"
             ng-model="game.board.layers.scenario" />
      <label for="layer-scenario-check">Scenario</label>
      <input id="layer-models-check"
             type="checkbox"
             ng-model="game.board.layers.models" />
      <label for="layer-models-check">Models</label>
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;">
      <button ng-click="game.rollDice(1)">1d6</button>
      <button ng-click="game.rollDice(2)">2d6</button>
      <button ng-click="game.rollDice(3)">3d6</button>
      <button ng-click="game.rollDice(4)">4d6</button>
      <button ng-click="game.rollDice(5)">5d6</button>
      <form style="margin:0;"
            ng-submit="doSendMessage()">
        <input style="width:100%;"
               ng-model="chat_msg"
               placeholder="Chat msg..." />
      </form>
      <div>
        <strong>New Messages :</strong>
      </div>
      <div ng-repeat="msg in game.new_messages.slice().reverse()">
        {{msg.type}} - {{msg.text}}
      </div>
      <div>
        <strong>Messages :</strong>
      </div>
      <div ng-repeat="msg in game.messages.slice().reverse()">
        {{msg.type}} - {{msg.text}}
      </div>
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;">
      <div>
        <strong>New Commands :</strong>
        <button ng-click="game.undoLastCommand()">Undo</button>
      </div>
      <div ng-repeat="cmd in game.new_commands.slice().reverse()">
        {{cmd.desc()}} - {{cmd.stamp}}
      </div>
      <div>
        <strong>Commands :</strong>
        <button ng-click="game.undoLastCommand()">Undo</button>
      </div>
      <div ng-repeat="cmd in game.commands.slice().reverse()">
        {{cmd.desc()}} - {{cmd.stamp}}
      </div>
    </div>
  </div>
  <div style="">
    Mouse Actions :
    <ul>
      <li>click on model : select the model</li> 
      <li>Ctrl + click on models : select multiple models</li>
      <li>Drag-Box (Ruler mode off) : select multiple models</li>
      <li>Drag (Ruler mode on) : mesure distance</li>
      <li>Drag on a selected model : drag all selected models</li>
    </ul>
    Keyboard shortcuts :
    <ul>
      <li>+/- (Numeric Kbd only) : Zoom in/out</li>
      <li>Alt + Directionnal Arrows : move view</li>
      <li>(Shift + )Up/Down Arrows : (small) advance selected model</li>
      <li>(Shift + )Right/Left Arrows : (small) rotate selected model</li>
      <li>(Shift + )Ctrl + Directionnal Arrows : (small) move selected model</li>
      <li>m : toggle melee range of selected model</li>
      <li>r : toggle reach range of selected model</li>
      <li>d : toggle Ruler mode</li>
    </ul>
  </div>
</div>
