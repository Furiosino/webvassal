<div style="vertical-align:top"
     ng-keydown="onKeyDown($event)"
     ng-keypress="onKeyPress($event)"
     tabindex="0"
     >
  <div style="display: inline-block;margin:0;padding:0;"
       >
    <strong>Game Id : {{game.id}}</strong><br />
    <svg style="border:1px solid black;display: inline-block;margin:0;padding:0;"
         width="800px" height="800px"
         viewBox="
         {{game.board.view.x}} {{game.board.view.y}}
         {{game.board.view.width}} {{game.board.view.height}}"
         preserveAspectRatio="xMinYMin meet"
         ng-mousedown="doSelectStart($event)"
         ng-mousemove="doSelectMove($event)"
         ng-mouseup="doSelectStop($event)"
         >
      <defs>
        <filter id="aura-filter"
                x="-50%" y="-50%"
                width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic"
                          stdDeviation="2"/>
        </filter>
        <marker id="ruler-start"
                markerWidth="6" markerHeight="8"
                refx="0" refy="4"
                orient="auto">
          <polygon points="6,8 0,4 6,0"
                   style="
                   fill:#0CC;
                   "
                   />
          <line x1="0" y1="1" x2="0" y2="7"
                style="
                stroke:#0CC;
                stroke-width:2px;
                "
                />
        </marker>
        <marker id="ruler-end"
                markerWidth="6" markerHeight="8"
                refx="6" refy="4"
                orient="auto">
          <polygon points="0,8 6,4 0,0"
                   style="
                   fill:#0CC;
                   "
                   />
          <line x1="6" y1="1" x2="6" y2="7"
                style="
                stroke:#0CC;
                stroke-width:2px;
                "
                />
        </marker>
        <marker id="aoe-direction-end"
                markerWidth="6" markerHeight="8"
                refx="6" refy="4"
                orient="auto">
          <polygon points="0,8 6,4 0,0"
                   style="
                   fill:#0F0;
                   "
                   />
        </marker>
      </defs>
      <image id="canvas"
             x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
             xlink:href="data/board/Board.png"
             style="display: {{game.layers.board ? 'inline' : 'none'}}"
             />
      <svg x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.terrain ? 'inline' : 'none'}}"
           >
        <rect x="120" y="136" width="60" height="43"
              style="
              fill:#00F;
              fill-opacity:0.2;
              "
              transform="rotate(40, 150, 155)"
              />
        <rect x="295" y="308" width="85" height="64"
              style="
              fill:#00F;
              fill-opacity:0.2;
              "
              transform="rotate(40, 338, 340)"
              />
        <rect x="205" y="242" width="70" height="7"
              style="
              fill:#F00;
              fill-opacity:0.2;
              "
              transform="rotate(84, 240, 245)"
              />
        <circle cx="90" cy="242" r="29"
                style="
                fill:#0F0;
                fill-opacity:0.2;
                "
                />
        <circle cx="390" cy="242" r="29"
                style="
                fill:#0F0;
                fill-opacity:0.2;
                "
                />
      </svg>
      <svg x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.deployment ? 'inline' : 'none'}}"
           >
        <line x1="0" y1="70"
              x2="480" y2="70"
              style="
              stroke:#000;
              stroke-width:1px;
              "
              />
        <rect x="0" y="58"
              width="20" height="12"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="69"
              style="
              font-size:12px;
              "
              >7"</text>
        <line x1="0" y1="130"
              x2="480" y2="130"
              style="
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <rect x="0" y="122"
              width="15" height="8"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="129"
              style="
              font-size:8px;
              "
              >13"</text>

        <line x1="0" y1="100"
              x2="480" y2="100"
              style="
              stroke:#000;
              stroke-width:1px;
              "
              />
        <rect x="0" y="88"
              width="20" height="12"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="99"
              style="
              font-size:12px;
              "
              >10"</text>
        <line x1="0" y1="160"
              x2="480" y2="160"
              style="
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <rect x="0" y="152"
              width="15" height="8"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="159"
              style="
              font-size:8px;
              "
              >16"</text>

        <line x1="0" y1="380"
              x2="480" y2="380"
              style="
              stroke:#000;
              stroke-width:1px;
              "
              />
        <rect x="0" y="368"
              width="20" height="12"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="379"
              style="
              font-size:12px;
              "
              >10"</text>
        <line x1="0" y1="320"
              x2="480" y2="320"
              style="
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <rect x="0" y="312"
              width="15" height="8"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="319"
              style="
              font-size:8px;
              "
              >16"</text>

        <line x1="0" y1="410"
              x2="480" y2="410"
              style="
              stroke:#000;
              stroke-width:1px;
              "
              />
        <rect x="0" y="398"
              width="20" height="12"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="409"
              style="
              font-size:12px;
              "
              >7"</text>
        <line x1="0" y1="350"
              x2="480" y2="350"
              style="
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <rect x="0" y="342"
              width="15" height="8"
              style="
              fill:#ffc;
              fill-opacity:0.5;
              stroke:none;
              "
              />
        <text x="0" y="349"
              style="
              font-size:8px;
              "
              >13"</text>

        <line x1="0" y1="30"
              x2="480" y2="30"
              style="
              stroke:#000;
              stroke-width:1px;
              stroke-dasharray: 5 5;
              "
              />
        <line x1="30" y1="0"
              x2="30" y2="480"
              style="
              stroke:#000;
              stroke-width:1px;
              stroke-dasharray: 5 5;
              "
              />
        <line x1="0" y1="450"
              x2="480" y2="450"
              style="
              stroke:#000;
              stroke-width:1px;
              stroke-dasharray: 5 5;
              "
              />
        <line x1="450" y1="0"
              x2="450" y2="480"
              style="
              stroke:#000;
              stroke-width:1px;
              stroke-dasharray: 5 5;
              "
              />
      </svg>
      <svg x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.scenario ? 'inline' : 'none'}}"
           >
        <rect x="140" y="140" width="200" height="200"
              style="
              fill:none;
              stroke:#990;
              stroke-width:0.5px;
              "
              />
        <rect x="180" y="210" width="120" height="60"
              style="
              fill:#CC0;
              fill-opacity:0.3;
              stroke:#990;
              stroke-width:0.5px;
              "
              />
        <circle cx="180" cy="270" r="9.842"
                style="
                fill:#CC0;
                fill-opacity:0.8;
                stroke:#C90;
                stroke-width:0.5px;
                "
                />
        <!-- <circle cx="180" cy="270" r="49.842"
        style="
        fill:#C60;
        fill-opacity:0.1;
        stroke:#C90;
        stroke-width:0.5px;
        "
        /> -->
        <circle cx="300" cy="210" r="9.842"
                style="
                fill:#CC0;
                fill-opacity:0.8;
                stroke:#C90;
                stroke-width:0.5px;
                "
                />
        <!-- <circle cx="300" cy="210" r="49.842"
        style="
        fill:#C60;
        fill-opacity:0.1;
        stroke:#C90;
        stroke-width:0.5px;
        "
        /> -->
      </svg>
      <svg id="locked-template-canvas"
           x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.templates ? 'inline' : 'none'}}"
           >
        <circle ng-repeat="aoe in templateShowLocked('aoe')"
                cx="{{aoe.x}}"
                cy="{{aoe.y}}"
                r="{{aoe.size*5}}"
                style="
                fill:#F90;
                fill-opacity:0.2;
                stroke-width:0.5px;
                "
                ng-style="{
                 'stroke': aoe === game.templates.active ? '#0F0' : '#C60',
                }"
                ng-mousedown="onTemplateMouseDown($event, aoe)"
                />
        <polygon ng-repeat="sp in templateShowLocked('spray')"
                 points="
                 8.75,0
                 {{
                 (10-8.125*sp.size/10) + ','  + (98.34*sp.size/10) +
                 ' 10,' + (100*sp.size/10) +
                 ' ' + (10+8.125*sp.size/10) + ',' + (98.34*sp.size/10)
                 }}
                 11.25,0
                 "
                 style="
                 fill:#F90;
                 fill-opacity:0.2;
                 stroke-width:0.5px;
                 "
                 transform="
                 translate({{sp.x-10}},{{sp.y}})
                 rotate({{sp.rot-180}}, 10, 0)
                 "
                 ng-style="{
                 'stroke': sp === game.templates.active ? '#0F0' : '#C60',
                 }"
                 ng-mousedown="onTemplateMouseDown($event, sp)"
                 />
      </svg>
      <svg id="model-canvas"
           x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.models ? 'inline' : 'none'}}"
           >
        <circle ng-repeat="model in modelShow('color')"
                cx="{{model.state.x}}" cy="{{model.state.y}}"
                r="{{model.info.r+2}}"
                style="
                fill:{{model.state.show_color}};
                filter: url(#aura-filter);
                "
                />
        <svg ng-repeat="model in game.models"
             x="{{model.state.x - model.info.width/2}}" y="{{model.state.y - model.info.height/2}}">
          <g transform="rotate({{model.state.rot}}, {{model.info.width/2}}, {{model.info.height/2}})">
            <circle ng-mousedown="onModelMouseDown($event, model)"
                    ng-click="onModelClick($event, model)"
                    cx="{{model.info.width/2}}" cy="{{model.info.height/2}}" r="{{model.info.r}}"
                    style="
                    fill:{{model.info.color}};
                    fill-opacity:1.0;
                    stroke:black;
                    stroke-width:0.5px;
                    "
                    /> 
            <line x1="{{model.info.width/2-model.info.r}}" y1="{{model.info.height/2}}"
                  x2="{{model.info.width/2+model.info.r}}" y2="{{model.info.height/2}}"
                  style="
                  stroke:black;
                  stroke-width:0.5px;
                  pointer-events: none;
                  "
                  />
            <line x1="{{model.info.width/2}}" y1="{{model.info.height/2}}"
                  x2="{{model.info.width/2}}" y2="{{model.info.height/2-model.info.r}}"
                  style="
                  stroke:black;
                  stroke-width:0.5px;
                  pointer-events: none;
                  "
                  />
            <image ng-show="model.state.show_image"
                   x="{{model.info.img.x}}" y="{{model.info.img.y}}"
                   width="{{model.info.width}}" height="{{model.info.height}}"
                   xlink:href="{{(model.state.show_incorporeal && model.info.img.incorporeal) ? model.info.img.incorporeal : ((model.state.show_leader && model.info.img.leader) ? model.info.img.leader : model.info.img.link)}}"
                   style="pointer-events: none"
                   />
            <line ng-show="model.info.damage.total > 1"
              x1="{{model.info.width/2-model.info.r}}" y1="{{model.info.height/2+model.info.r}}"
              x2="{{model.info.width/2+model.info.r}}" y2="{{model.info.height/2+model.info.r}}"
              style="
              stroke:#0F0;
              stroke-width:1px;
              pointer-events: none;
              "
              />
            <line ng-show="model.info.damage.total > 1"
              x1="{{model.info.width/2-model.info.r}}" y1="{{model.info.height/2+model.info.r}}"
              x2="{{model.info.width/2-model.info.r+model.info.r*2*model.state.damage.total/model.info.damage.total}}"
              y2="{{model.info.height/2+model.info.r}}"
              style="
              stroke:#F00;
              stroke-width:1px;
              pointer-events: none;
              "
              />
            <g ng-if="model.info.damage.field">
              <line x1="{{model.info.width/2-model.info.r}}"
                    y1="{{model.info.height/2+model.info.r+1}}"
                    x2="{{model.info.width/2+model.info.r}}"
                    y2="{{model.info.height/2+model.info.r+1}}"
                    style="
                    stroke:#0FF;
                    stroke-width:1px;
                    pointer-events: none;
                    "
                    />
              <line x1="{{model.info.width/2-model.info.r}}"
                    y1="{{model.info.height/2+model.info.r+1}}"
                    x2="{{model.info.width/2-model.info.r+model.info.r*2*model.state.damage.field/model.info.damage.field}}"
                    y2="{{model.info.height/2+model.info.r+1}}"
                    style="
                    stroke:#066;
                    stroke-width:1px;
                    pointer-events: none;
                    "
                    />
            </g>
            <image ng-if="model.state.show_fire"
                   x="{{model.info.width/2-4}}"
                   y="{{model.info.height/2+model.info.r-1}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Fire.png"
                   style="pointer-events:none;"
                   />
            <image ng-if="model.state.show_corrosion"
                   x="{{model.info.width/2-11}}"
                   y="{{model.info.height/2+model.info.r+1}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Corrosion.png"
                   style="pointer-events:none;"
                   />
            <image ng-if="model.state.show_stationary"
                   x="{{model.info.width/2+2}}"
                   y="{{model.info.height/2+model.info.r}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Stationary.png"
                   style="pointer-events:none;"
                   />
            <image ng-if="model.state.show_blind"
                   x="{{model.info.width/2-18}}"
                   y="{{model.info.height/2+model.info.r-1}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Blind.png"
                   style="pointer-events:none;"
                   />
            <image ng-if="model.state.show_kd"
                   x="{{model.info.width/2+9}}"
                   y="{{model.info.height/2+model.info.r}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Disrupted.png"
                   style="pointer-events:none;"
                   />
            <image ng-if="model.state.show_leader"
                   x="{{model.info.width/2-5+model.info.r*0.7}}"
                   y="{{model.info.height/2-5+model.info.r*0.7-1}}"
                   width="10"
                   height="10"
                   xlink:href="data/icons/Leader.png"
                   style="pointer-events:none;"
                   />
          </g>
          <g ng-if="model.state.label.length != 0">
            <rect x="{{model.info.width/2-model.state.label.length*3.5/2-2}}"
                  y="{{
                  model.info.height/2+(((model.state.rot%360) > 90 && (model.state.rot%360) < 270) ? (model.info.r) : (-model.info.r-7))
                  }}"
                  width="{{model.state.label.length*3.5+4}}" height="6"
                  style="
                  fill:#333;
                  fill-opacity:0.4;
                  pointer-events: none;
                  "
                  />
            <text x="{{model.info.width/2}}"
                  y="{{
                  model.info.height/2+(((model.state.rot%360) > 90 && (model.state.rot%360) < 270) ? (model.info.r+6) : (-model.info.r-2))
                  }}"
                  style="
                  fill:white;
                  text-anchor:middle;
                  font-size:6px;
                  font-family:monospace;
                  pointer-events: none;
                  -webkit-user-select: none;
                  -moz-user-select:none;
                  "
                  >{{model.state.label}}</text>
          </g>
        </svg>
        <circle ng-repeat="id in game.update_selection"
                cx="{{game.models[id].state.x}}"
                cy="{{game.models[id].state.y}}"
                r="{{game.models[id].info.r}}"
                style="
                fill:none;
                stroke: #FFF;
                stroke-width:0.75px;
                pointer-events: none;
                "
                />
        <circle ng-repeat="id in game.selection"
                cx="{{game.models[id].state.x}}"
                cy="{{game.models[id].state.y}}"
                r="{{game.models[id].info.r}}"
                style="
                fill:none;
                stroke-width:1px;
                pointer-events: none;
                "
                ng-style="{
                'stroke': game.templates.active ? none : (modes.current.name === 'Model Target' ? '#00F' : '#0F0')
                }"
                />
        <path ng-repeat="model in modelShow('melee')"
              d="
              M{{model.state.x-5-model.info.r}},{{model.state.y}}
              L{{model.state.x+5+model.info.r}},{{model.state.y}}
              A{{5+model.info.r}},{{5+model.info.r}} 0 0,0
              {{model.state.x-5-model.info.r}},{{model.state.y}}
              M{{model.state.x}},{{model.state.y}}
              L{{model.state.x}},{{model.state.y-model.info.r-5}}
              "
              style="
              stroke:#000;
              stroke-width:0.5px;
              fill: #000;
              fill-opacity: 0.4;
              pointer-events: none;
              "
              transform="
              rotate({{model.state.rot}},
              {{model.state.x}},
              {{model.state.y}})
              "
              />
        <path ng-repeat="model in modelShow('reach')"
              d="
              M{{model.state.x-20-model.info.r}},{{model.state.y}}
              L{{model.state.x+20+model.info.r}},{{model.state.y}}
              A{{20+model.info.r}},{{20+model.info.r}} 0 0,0
              {{model.state.x-20-model.info.r}},{{model.state.y}}
              M{{model.state.x}},{{model.state.y}}
              L{{model.state.x}},{{model.state.y-model.info.r-20}}
              "
              style="
              stroke:#000;
              stroke-width:0.5px;
              fill: #000;
              fill-opacity: 0.4;
              pointer-events: none;
              "
              transform="
              rotate({{model.state.rot}},
              {{model.state.x}},
              {{model.state.y}})
              "
              />
        <circle ng-repeat="model in modelShow('control')"
                cx="{{model.state.x}}" cy="{{model.state.y}}"
                r="{{model.info.r+(model.info.focus || model.info.fury)*20}}"
                style="
                fill: #0FF;
                fill-opacity: 0.3;
                stroke: #099;
                stroke-width: 1px;
                pointer-events: none;
                "
                />
        <circle ng-repeat="model in showCenteredAoE()"
                cx="{{model.state.x}}"
                cy="{{model.state.y}}"
                r="{{model.state.show_aoe}}"
                style="
                fill:#F90;
                fill-opacity:0.2;
                stroke:#C60;
                stroke-width:0.5px;
                pointer-events: none;
                "
                />
        <g ng-repeat="model in modelShow('focus')">
          <rect x="{{model.state.x-4}}" y="{{model.state.y-4}}"
                width="8" height="9"
                style="
                fill:#333;
                fill-opacity:0.7;
                pointer-events: none;
                "
                />
          <text x="{{model.state.x}}" y="{{model.state.y+4}}"
                style="
                fill:white;
                text-anchor:middle;
                font-size:9px;
                font-weight:bold;
                font-family:Verdana, sans-serif;
                pointer-events: none;
                -webkit-user-select: none;
                -moz-user-select:none;
                "
                >
            {{model.state.focus}}
          </text>
        </g>
      </svg>
      <svg id="template-canvas"
           x="0" y="0" width="{{game.board.width}}" height="{{game.board.height}}"
           style="display: {{game.layers.templates ? 'inline' : 'none'}}"
           >
        <circle ng-repeat="aoe in templateShowUnlocked('aoe')"
                cx="{{aoe.x}}"
                cy="{{aoe.y}}"
                r="{{aoe.size*5}}"
                style="
                fill:#F90;
                fill-opacity:0.5;
                stroke-width:0.5px;
                "
                ng-style="{
                 'stroke': aoe === game.templates.active ? (modes.current.name === 'Template Origin' ? '#FF0' : (modes.current.name === 'Template Target' ? '#0FF' : '#0F0')) : '#C60',
                }"
                ng-click="onTemplateClick($event, aoe)"
                ng-mousedown="onTemplateMouseDown($event, aoe)"
                />
        <line ng-show="game.templates.active.type == 'aoe' && !game.templates.active.locked"
              x1="{{game.templates.active.x}}" y1="{{game.templates.active.y}}"
              x2="{{game.templates.active.x}}" y2="{{game.templates.active.y-game.templates.active.size*5}}"
              style="
              stroke-width:0.75px;
              marker-end:url(#aoe-direction-end);
              "
              ng-style="{
              'stroke': mode_template_origin ? '#FF0' : (mode_template_target ? '#0FF' : '#0F0')
              }"
              transform="
              rotate({{game.templates.active.rot}},
              {{game.templates.active.x}},
              {{game.templates.active.y}})
              "
              />
        <polygon ng-repeat="sp in templateShowUnlocked('spray')"
                 points="
                 8.75,0
                 {{
                 (10-8.125*sp.size/10) + ','  + (98.34*sp.size/10) +
                 ' 10,' + (100*sp.size/10) +
                 ' ' + (10+8.125*sp.size/10) + ',' + (98.34*sp.size/10)
                 }}
                 11.25,0
                 "
                 style="
                 fill:#F90;
                 fill-opacity:0.5;
                 stroke-width:0.5px;
                 "
                 transform="
                 translate({{sp.x-10}},{{sp.y}})
                 rotate({{sp.rot-180}}, 10, 0)
                 "
                 ng-style="{
                 'stroke': sp === game.templates.active ? (modes.current.name === 'Template Origin' ? '#FF0' : (modes.current.name === 'Template Target' ? '#0FF' : '#0F0')) : '#C60',
                 }"
                 ng-click="onTemplateClick($event, sp)"
                 ng-mousedown="onTemplateMouseDown($event, sp)"
                 />
        <circle ng-show="game.templates.active !== null && game.templates.active.origin !== null"
                cx="{{game.templates.active.origin.state.x}}"
                cy="{{game.templates.active.origin.state.y}}"
                r="{{game.templates.active.origin.info.r}}"
                style="
                fill:none;
                stroke:#FF0;
                stroke-width:1px;
                pointer-events: none;
                "
                />
      </svg>
      <circle ng-show="
              modes.current.name === 'Template Create' &&
              modes.current.type === 'aoe'
              "
              cx="{{modes.current.x}}"
              cy="{{modes.current.y}}"
              r="{{modes.current.size*5}}"
              style="
              fill:#F90;
              fill-opacity:0.5;
              stroke-width:0.5px;
              pointer-events: none;
              stroke: #C60;
              "
              />
      <polygon ng-show="
               modes.current.name === 'Template Create' &&
               modes.current.type === 'spray'
               "
               points="
               8.75,0
               {{
               (10-8.125*modes.current.size/10) +
               ','  + (98.34*modes.current.size/10) +
               ' 10,' + (100*modes.current.size/10) +
               ' ' + (10+8.125*modes.current.size/10) +
               ',' + (98.34*modes.current.size/10)
               }}
               11.25,0
               "
               style="
               fill:#F90;
               fill-opacity:0.5;
               stroke:#C60,
               stroke-width:0.5px;
               "
               transform="
               translate({{modes.current.x-10}},{{modes.current.y}})
               rotate({{modes.current.rot-180}}, 10, 0)
               "
               />
      <svg ng-show="modes.current.name === 'Model Create'"
           ng-repeat="(i,model) in modes.current.info"
           x="{{modes.current.x + model.offset_x - model.info.width/2}}"
           y="{{modes.current.y + model.offset_y - model.info.height/2}}"
           style="pointer-events: none"
           >
        <image x="{{model.info.img.x}}"
               y="{{model.info.img.y}}"
               width="{{model.info.width}}"
               height="{{model.info.height}}"
               xlink:href="{{model.info.img.link}}"
               />
        <circle cx="{{model.info.width/2}}"
                cy="{{model.info.height/2}}"
                r="{{model.info.r}}"
                style="
                fill:#F00;
                fill-opacity:0.5;
                stroke-width:1px;
                "
                />
      </svg>
      <rect ng-if="modes.current.name === 'Selection Drag'"
            x="{{modes.current.x}}" y="{{modes.current.y}}"
            width="{{modes.current.width}}" height="{{modes.current.height}}"
            style="
            fill: none;
            stroke:#00F;
            stroke-width:0.5px;
            " />
      <circle ng-show="
              modes.current.group === 'Ruler' &&
              modes.current.origin !== null
              "
              cx="{{modes.current.origin.state.x}}"
              cy="{{modes.current.origin.state.y}}"
              r="{{modes.current.origin.info.r}}"
              style="
              fill:none;
              stroke:#F90;
              stroke-width:1px;
              pointer-events: none;
              "
              />
      <circle ng-show="
              modes.current.group === 'Ruler' &&
              modes.current.target !== null
              "
              cx="{{modes.current.target.state.x}}"
              cy="{{modes.current.target.state.y}}"
              r="{{modes.current.target.info.r}}"
              style="
              fill:none;
              stroke:#F09;
              stroke-width:1px;
              pointer-events: none;
              "
              />
      <g ng-show="game.ruler.state.active"
         style="pointer-events: none"
         >
        <line x1="{{game.ruler.state.x1}}" y1="{{game.ruler.state.y1}}"
              x2="{{game.ruler.state.x2}}" y2="{{game.ruler.state.y2}}"
              style="
              stroke-width:1px;
              marker-start:url(#ruler-start);
              marker-end:url(#ruler-end);
              "
              ng-style="{
              'stroke': (modes.current.name === 'Ruler Target') ? '#F09' : (modes.current.name === 'Ruler Origin' ? '#F90' : '#0FF')
              }"
              />
        <rect x="{{(game.ruler.state.x2-game.ruler.state.x1)/2+game.ruler.state.x1-2.5}}"
              y="{{(game.ruler.state.y2-game.ruler.state.y1)/2+game.ruler.state.y1-4}}"
              width="30" height="10"
              style="
              fill:#FFC;
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <text x="{{(game.ruler.state.x2-game.ruler.state.x1)/2+game.ruler.state.x1}}"
              y="{{(game.ruler.state.y2-game.ruler.state.y1)/2+game.ruler.state.y1+4}}"
              style="
              font-size:8px;
              ">
          {{game.ruler.state.length}}"
        </text>
      </g>
      <line ng-show="game.los.state.active"
            x1="{{game.los.state.x1}}" y1="{{game.los.state.y1}}"
            x2="{{game.los.state.x2}}" y2="{{game.los.state.y2}}"
            style="
            stroke: #0F0;
            stroke-width:0.5px;
            pointer-events: none;
            "
            />
      <g ng-show="modes.current.name === 'Model Drag'"
         style="pointer-events: none"
         >
        <line x1="{{modes.current.start_x}}" y1="{{modes.current.start_y}}"
              x2="{{modes.current.end_x}}" y2="{{modes.current.end_y}}"
              style="
              stroke:#0FF;
              stroke-width:1px;
              marker-start:url(#ruler-start);
              marker-end:url(#ruler-end);
              "
              />
        <rect x="{{(modes.current.end_x-modes.current.start_x)/2+modes.current.start_x-2.5}}"
              y="{{(modes.current.end_y-modes.current.start_y)/2+modes.current.start_y-4}}"
              width="30" height="10"
              style="
              fill:#FFC;
              stroke:#000;
              stroke-width:0.5px;
              "
              />
        <text x="{{(modes.current.end_x-modes.current.start_x)/2+modes.current.start_x}}"
              y="{{(modes.current.end_y-modes.current.start_y)/2+modes.current.start_y+4}}"
              style="
              font-size:8px;
              ">
          {{modes.current.length}}"
        </text>
      </g>
    </svg>
  </div>
  <div style="display:inline-block;vertical-align:top;width:350px">
    <div>
      <button ng-style="{
              'background-color': force_ctrl ? '#6F6' : 'none'
              }"
              ng-click="force_ctrl = !force_ctrl"
              >Ctrl</button>
      <button ng-style="{
              'background-color': force_shift ? '#6F6' : 'none'
              }"
              ng-click="force_shift = !force_shift"
              >Shift</button>
    </div>
    <div style="border:1px solid black;max-height:300px;overflow-y:scroll;"
         ng-include="'partials/modeBox.html'">
    </div>
    <div style="border:1px solid black;max-height:300px;overflow-y:scroll;"
         ng-show="game.selection.length === 1"
         ng-include="'partials/modelViewBox.html'">
    </div>
    <div style="border:1px solid black;max-height:600px;overflow-y:scroll;"
         ng-include="'partials/createBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/importBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/dropBinBox.html'">
    </div>
  </div>
  <div style="display:inline-block;vertical-align:top;width:350px">
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/toolsBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/layersBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/chatBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/commandBox.html'">
    </div>
    <div style="border:1px solid black;max-height:200px;overflow-y:scroll;"
         ng-include="'partials/backupBox.html'">
    </div>
  </div>
  <div>
    Mouse Actions :
    <ul>
      <li>click on model : select the model</li> 
      <li>Ctrl + click on models : select multiple models</li>
      <li>Drag-Box (Ruler mode off) : select multiple models</li>
      <li>Drag (Ruler mode on) : mesure distance</li>
      <li>Drag on a selected model : drag all selected models</li>
    </ul>
    Keyboard shortcuts :
    <ul>
      <li>Esc : exit sub-modes</li>
      <li>Alt + +/- (Numeric Kbd only) : Zoom in/out</li>
      <li>Alt + Directionnal Arrows : move view</li>
      <li>Alt + 0 : reset view</li>
      <li>(Shift + )Up/Down Arrows : (small) advance selected model/template</li>
      <li>(Shift + )Right/Left Arrows : (small) rotate selected model/template</li>
      <li>(Shift + )Ctrl + Directionnal Arrows : (small) move selected model/template</li>
      <li>Ctrl + n/e/s/w : set selected model orientation to North/East/South/West</li>
      <li>Ctrl+z : undo last command.</li>
      <li>Ctrl+c : copy selected models (move mouse to place new models, then click to create).</li>
      <li>Shift+c : toggle warnouns Control Zone.</li>
      <li>Suppr (AoE selected) : delete selected template.</li>
      <li>Suppr (model selected) : move selected models to drop bin.</li>
      <li>d (AoE selected): auto-deviate AoE</li>
      <li>f : toggle focus/counter of selected model</li>
      <li>i : toggle image of selected model</li>
      <li>l : lock selected template (place it under models and prevent drag)</li>
      <li>L (Shift+l): toggle LOS mode</li>
      <li>m : toggle melee range of selected model</li>
      <li>r (AoE selected & ruler active) : place the selected AoE at the end of the ruler.</li>
      <li>r (model selected) : toggle reach range of selected model</li>
      <li>R (Shift+r): toggle Ruler mode</li>
      <li>o (template selected/ruler mode) : trigger template/ruler's origin selection mode</li>
      <li>t (template selected/ruler mode/model selected) : trigger template/ruler/model's target selection mode</li>
      <li>u : unselect all models.</li>
      <li>+/- (Numeric Kbd only) : increment/decrement focus/counter of selected model.</li>
      <li>Ctrl + 1/2/3/4/5/6/0 : set selected model aura color (0 = Off)</li>
      <li>3/4/5 (AoE selected) : change AoE size to 3/4/5"</li>
      <li>3/4/5 (model selected) : toggle AOE 3/4/5" centered on selected model</li>
      <li>6/8/0 (Spray selected) : change spray size to 6/8/10"</li>
      <li>Alt + b/c/f/k/s (model selected) : toggle Blind/Corrosion/Fire/KD/Stationary marker.</li>
      <li>Alt + i (model selected) : toggle incorporeal (if it exists) for selected model.</li>
      <li>Alt + p (model selected) : toggle promote (leader marker) for selected model.</li>
    </ul>
  </div>
</div>
